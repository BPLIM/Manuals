Bootstrap: docker
From: ubuntu:20.04
IncludeCmd: yes


%files
  #/mnt/cephfs/Downloads/libpng12-0_1.2.54-1ubuntu1.11ppa0eoan_amd64.deb
  #/mnt/cephfs/Downloads/libpng12-0_1.2.54-1ubuntu1.1_amd64.deb
  #/mnt/cephfs/colaborativo/DEE-BPLIM-Filial/containers/cran_key.txt


%environment

  R_VERSION=4.1.0
  export R_VERSION
  R_CONFIG_DIR=/etc/R/
  export R_CONFIG_DIR
  export LC_ALL=C
  export PATH=$PATH

   TZ=Europe/Lisbon
   export PATH="/opt/stata16:$PATH"


%labels
Author Gustavo Igl√©sias, Miguel Portela and Rita Sousa -- BPLIM
Version v0.0.1: R + RStudio for researchers
R_Version 4.0.4
build_date 2021 November 16


%post
  apt-get update
  apt-get install -y apt-transport-https apt-utils software-properties-common
  apt-get install -y add-apt-key
  export DEBIAN_FRONTEND=noninteractive
  ln -fs /usr/share/zoneinfo/Europe/London /etc/localtime
  apt-get install -y tzdata
  dpkg-reconfigure --frontend noninteractive tzdata

  apt update
  apt-get update
  apt install -y software-properties-common wget
    

  # R

      apt-get update
      apt update
      apt update -qq
  
apt update -qq

apt install -y --no-install-recommends software-properties-common dirmngr
wget -qO- https://cloud.r-project.org/bin/linux/ubuntu/marutter_pubkey.asc | tee -a /etc/apt/trusted.gpg.d/cran_ubuntu_key.asc
add-apt-repository "deb https://cloud.r-project.org/bin/linux/ubuntu $(lsb_release -cs)-cran40/"
	apt-get update

    apt-get install -y --no-install-recommends r-base r-recommended libnss3

  ###

	  apt-get install -y wget nano gnupg gnupg2 curl
	       apt-get update
	  apt-get install -y libblas3 libblas-dev liblapack-dev liblapack3 curl aptitude
	     apt-get update
	  aptitude install -y xorg-dev
	      apt-get update
	  aptitude install -y libreadline-dev
	      apt-get update
	  apt-get install -y libssl-dev libxml2-dev libpcre3-dev liblzma-dev libbz2-dev libcurl4-openssl-dev libmagick++-dev
	      apt-get update
	  apt-get install -y libhdf5-dev hdf5-helpers git

	  apt-get update
	  apt-get -y install xkb-data x11-apps bzip2 qt5-default mesa-utils libgl1-mesa-dev libgl1-mesa-glx libegl1-mesa libxrandr2 libxrandr2 libxss1 libxcursor1 libxcomposite1 libasound2 libxi6 libxtst6 iproute2 swig build-essential software-properties-common net-tools unixodbc-dev git vim cython cmake

  ###

  #  RStudio
  
    wget https://download1.rstudio.org/desktop/bionic/amd64/rstudio-2021.09.0-351-amd64.deb
    apt install -y ./rstudio-2021.09.0-351-amd64.deb
    
    rm rstudio-2021.09.0-351-amd64.deb

  # INSTALL R PACKAGES

R --slave -e 'install.packages("devtools",dependencies = TRUE, type="source")'
R --slave -e 'install.packages(c("tidyverse"), dependencies = TRUE)'
